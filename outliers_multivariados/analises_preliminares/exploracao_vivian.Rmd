---
title: "Exploração dos dados da tese de doutorado da Vivian"
author: "Melina Leite"
date: "outubro de 2015"
output: pdf_document

---

```{r setup, echo = F, message = F, cache = F}
knitr::opts_chunk$set(comment = NA, message = FALSE, echo=F, cache=FALSE, warning=FALSE)
```


```{r, echo=F, message=FALSE}
library(moments) #kurtosis e skewness
library(car) #transformações e grafico correlação
library(MVN) #testes normalidade multivariada e histogramas
library(lavaan) #SEM
library(semPlot) #graficos SEM
```

# Tabela de dados
```{r}
da<-read.table("medias.csv",header=T,dec=".", sep = ";",row.names = 1)
str(da)
summary(da)
```

Separando as variáveis de água e de paisagem para facilitar análises.
```{r}
dagua<- da[,1:12]
dpais<- da[,13:18]
```

# Gráficos exploratórios das variáveis brutas

## variáveis da água
### Histograma + density (como se fosse normal)
```{r, fig.height=10,fig.width=8}
uniPlot(dagua, type="histogram")
```

### Boxplot identificando os outliers
```{r}
par(mfrow=c(4,3), mar=c(2,3,2,1))
for (i in 1:length(dagua)) {
    Boxplot(dagua[,i], main = colnames(dagua)[i])
}
```

### QQplot para ver normalidade
```{r}
par(mfrow=c(4,3), mar=c(2,3,2,1))
for (i in 1:length(dagua)) {
    qqnorm(dagua[,i], main = colnames(dagua)[i])
    qqline(dagua[,i])
}
dev.off()
```

## variáveis da paisagem
### Histograma + density (como se fosse normal)
```{r}
uniPlot(dpais, type="histogram")
```

### Boxplot identificando os outliers
```{r}
par(mfrow=c(3,2), mar=c(2,3,2,1))
for (i in 1:length(dpais)) {
    Boxplot(dpais[,i], main = colnames(dpais)[i])
}
```

### QQplot para ver normalidade
```{r}
par(mfrow=c(3,2), mar=c(2,3,2,1))
for (i in 1:length(dpais)) {
    qqnorm(dpais[,i], main = colnames(dpais)[i])
    qqline(dpais[,i])
}
```

# Testes de premissas SEM

## Valores de skewness e kurtosis
```{r}
sk.ku<-matrix(NA,ncol=4,nrow=18)
rownames(sk.ku)<-colnames(da)
colnames(sk.ku)<-c("skew","Pskew","kurt","Pkurt")
for (i in 1:length(da)){
    sk.ku[i,1]<-round(skewness(da[,i], na.rm=T),3)
    sk.ku[i,2]<-round(agostino.test(da[,i])$p,3)
    sk.ku[i,3]<-round(kurtosis(da[,i], na.rm=T),3)
    sk.ku[i,4]<-round(anscombe.test(da[,i])$p,3)
}
sk.ku
```
Dados com muitas variáveis com skewness e kurtosis significativos. Isso deve estar ocorrendo principalmente devido aos outliers.

## Normalidade de cada variável separadamente
```{r}
uniNorm(da)[2]
dev.off()
```
Como era de se esperar pela visualização dos gráficos.

## Teste de distribuição normal multivariada 
Teste de Mardia recomendado no Shipley (2004) usando pacote [MVN](https://journal.r-project.org/archive/2014-2/korkmaz-goksuluk-zararsiz.pdf). Como o teste só roda com até 15 variáveis, separei as de água e de paisagem:

### água
```{r}
mardiaTest(da[1:12], qqplot = T)
mvOutlier(da[1:12],qqplot = T)[1]
```

### paisagem
```{r}
mardiaTest(da[13:18], qqplot=T)
mvOutlier(da[1:12],qqplot = T)[1]
```

# Correlação entre as variáveis

```{r, echo=F}
#funcao para criar graficos
panel.cor <- function(x, y, digits = 2, prefix = "", cex.cor, ...)
{
      usr <- par("usr"); on.exit(par(usr))
      par(usr = c(0, 1, 0, 1))
      r <- cor(x, y, method='spearman', use="pairwise.complete.obs")
      txt <- format(c(r, 0.123456789), digits = digits)[1]
      txt <- paste0(prefix, txt)
      if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
      text(0.5, 0.5, txt, cex = 1)
}
```

Lembrando que os valores destas correlações levam em consideração os outliers. e vendo as linhas verdes, eles estão puxando muito os valores das correlações.

## Água
```{r, fig.height=10, fig.width=9}
spm(da[,1:12], smoother=F, upper.panel=panel.cor)
```

**Comentários:** correlação igual a 1 entre EC e TDS. 

## Paisagem

```{r}
spm(da[,13:18], smoother=T, upper.panel=panel.cor)
```

**Comentários:** correlação igual a 1 entre ED e TE. 


-------
